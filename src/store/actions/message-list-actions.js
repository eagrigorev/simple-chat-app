import firebase from "firebase";
import {
    MESSAGE_LIST_ADD_USER,
    MESSAGE_LIST_ADD_BOT,
    MESSAGE_LIST_UPDATE_FROM_FB,
} from "../../const";
export const messageListAddUser = (messageListName, messageListBody) => ({
    type: MESSAGE_LIST_ADD_USER,
    payload: {
        messageListName,
        messageListBody,
    },
});
export const messageListAddBot = (messageListName, messageListBody) => ({
    type: MESSAGE_LIST_ADD_BOT,
    payload: {
        messageListName,
        messageListBody,
    },
});
export const messageListAddBotThunk = (messageListName, messageListBody) => {
    return (dispatch, getState) => {
        setTimeout(() => {
            dispatch(messageListAddBot(messageListName, messageListBody));
        }, 3000);
    };
};
export const fbMessageListAddUser = (messageName, messageBody) => async () => {
    const message = {
        messageListName: messageName,
        messageListBody: messageBody,
    };
    firebase.database().ref("messageList").push(message);
};
export const fbMessageListAddBot = (messageName) => async () => {
    const botMessage = {
        messageListName: "Bot",
        messageListBody: `This is a bot reply to ${messageName}. That message was generated by Firebase in three seconds.`,
    };
    firebase.database().ref("messageList").push(botMessage);
};
export const fbMessageListAddUserThunk = (messageName, messageBody) => {
    return (dispatch, getState) => {
        dispatch(fbMessageListAddUser(messageName, messageBody));
    };
};
export const fbMessageListAddBotThunk = (messageName) => {
    return (dispatch, getState) => {
        setTimeout(() => {
            dispatch(fbMessageListAddBot(messageName));
        }, 3000);
    };
};
export const messageListUpdateFromFb = (fbMessageList) => ({
    type: MESSAGE_LIST_UPDATE_FROM_FB,
    payload: {
        fbMessageList,
    },
});
export const fbMessageListFetchStoreUpdate = () => {
    return (dispatch, getState) => {
        firebase
            .database()
            .ref("messageList")
            .on("value", (snapshot) => {
                const fbMessageList = [];
                snapshot.forEach((entry) => {
                    fbMessageList.push(entry.val());
                });
                console.log(fbMessageList);
                dispatch(messageListUpdateFromFb(fbMessageList));
            });
    };
};
